service cloud.firestore {
match /databases/{database}/documents {

// --- Helper Functions (ฟังก์ชันช่วยตรวจสอบ) ---
function isSignedIn() {
  return request.auth != null;
}

function isOwner() {
  return isSignedIn() && resource.data.userId == request.auth.uid;
}

function isValidOwner() {
  return isSignedIn() && request.resource.data.userId == request.auth.uid;
}

// --- Rules Definitions (กฎการเข้าถึง) ---

// 1. กฎสำหรับข้อมูลสภาพอากาศ (Public Read / No Write from Client)
match /weather_results/{docId} {
   allow read: if true;
   allow write: if false; 
}

// 2. กฎสำหรับโปรไฟล์ผู้ใช้
match /users/{userId} {
  allow read, write: if isSignedIn() && request.auth.uid == userId;
}

// 3. ข้อมูลส่วนตัวของผู้ใช้ (เข้าถึงได้เฉพาะเจ้าของเท่านั้น)
match /page_views/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /DashboardPage/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /HomePage/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /DataPage/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /dashboard_summaries/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /weather_minute_summary/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

match /data_searches/{docId} {
  allow read, delete: if isOwner();
  allow create: if isValidOwner();
  allow update: if isOwner() && isValidOwner();
}

// Collection อื่นๆ ที่ไม่ได้ระบุ จะถูก Block ทั้งหมดโดยอัตโนมัติ


}
}